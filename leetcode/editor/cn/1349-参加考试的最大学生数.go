//ç»™ä½ ä¸€ä¸ª m * n çš„çŸ©é˜µ seats è¡¨ç¤ºæ•™å®¤ä¸­çš„åº§ä½åˆ†å¸ƒã€‚å¦‚æœåº§ä½æ˜¯åçš„ï¼ˆä¸å¯ç”¨ï¼‰ï¼Œå°±ç”¨ '#' è¡¨ç¤ºï¼›å¦åˆ™ï¼Œç”¨ '.' è¡¨ç¤ºã€‚
//
// å­¦ç”Ÿå¯ä»¥çœ‹åˆ°å·¦ä¾§ã€å³ä¾§ã€å·¦ä¸Šã€å³ä¸Šè¿™å››ä¸ªæ–¹å‘ä¸Šç´§é‚»ä»–çš„å­¦ç”Ÿçš„ç­”å·ï¼Œä½†æ˜¯çœ‹ä¸åˆ°ç›´æ¥ååœ¨ä»–å‰é¢æˆ–è€…åé¢çš„å­¦ç”Ÿçš„ç­”å·ã€‚è¯·ä½ è®¡ç®—å¹¶è¿”å›è¯¥è€ƒåœºå¯ä»¥å®¹çº³çš„åŒæ—¶å‚åŠ è€ƒè¯•
//ä¸”æ— æ³•ä½œå¼Šçš„ æœ€å¤§ å­¦ç”Ÿäººæ•°ã€‚
//
// å­¦ç”Ÿå¿…é¡»ååœ¨çŠ¶å†µè‰¯å¥½çš„åº§ä½ä¸Šã€‚
//
//
//
// ç¤ºä¾‹ 1ï¼š
//
//
//
//
//è¾“å…¥ï¼šseats = [["#",".","#","#",".","#"],
//Â              [".","#","#","#","#","."],
//Â              ["#",".","#","#",".","#"]]
//è¾“å‡ºï¼š4
//è§£é‡Šï¼šæ•™å¸ˆå¯ä»¥è®© 4 ä¸ªå­¦ç”Ÿååœ¨å¯ç”¨çš„åº§ä½ä¸Šï¼Œè¿™æ ·ä»–ä»¬å°±æ— æ³•åœ¨è€ƒè¯•ä¸­ä½œå¼Šã€‚
//
//
// ç¤ºä¾‹ 2ï¼š
//
//
//è¾“å…¥ï¼šseats = [[".","#"],
//Â              ["#","#"],
//Â              ["#","."],
//Â              ["#","#"],
//Â              [".","#"]]
//è¾“å‡ºï¼š3
//è§£é‡Šï¼šè®©æ‰€æœ‰å­¦ç”Ÿååœ¨å¯ç”¨çš„åº§ä½ä¸Šã€‚
//
//
// ç¤ºä¾‹ 3ï¼š
//
//
//è¾“å…¥ï¼šseats = [["#",".",".",".","#"],
//Â              [".","#",".","#","."],
//Â              [".",".","#",".","."],
//Â              [".","#",".","#","."],
//Â              ["#",".",".",".","#"]]
//è¾“å‡ºï¼š10
//è§£é‡Šï¼šè®©å­¦ç”Ÿååœ¨ç¬¬ 1ã€3 å’Œ 5 åˆ—çš„å¯ç”¨åº§ä½ä¸Šã€‚
//
//
//
//
// æç¤ºï¼š
//
//
// seats åªåŒ…å«å­—ç¬¦ '.' å’Œ'#'
// m == seats.length
// n == seats[i].length
// 1 <= m <= 8
// 1 <= n <= 8
//
//
// Related Topics ä½è¿ç®— æ•°ç»„ åŠ¨æ€è§„åˆ’ çŠ¶æ€å‹ç¼© çŸ©é˜µ ğŸ‘ 169 ğŸ‘ 0

package main

import (
	"math/bits"
)

func main() {

}

// leetcode submit region begin(Prohibit modification and deletion)
func maxStudents(seats [][]byte) int {
	// çŠ¶å‹ dp
	maxVal := func(a, b int) int {
		if b > a {
			return b
		}
		return a
	}
	ms, m, n := 0, len(seats), len(seats[0])
	dp, z := make(map[int]int), 1<<n
	checkRow := func(r, s int) bool { // å½“å‰è¡Œçš„åˆæ³•æ€§
		for i := 0; i < n; i++ {
			if (s>>i)&1 == 1 && (seats[r][i] == '#' || i > 0 && (s>>(i-1))&1 == 1) {
				return false
			}
		}
		return true
	}
	checkPre := func(d, u int) bool { // dï¼šå½“å‰è¡Œï¼Œuï¼šä¸Šä¸€è¡Œï¼Œæ£€æŸ¥ä¸Šä¸€è¡Œçš„åˆæ³•æ€§
		for i := 0; i < n; i++ {
			if (d>>i)&1 == 1 && (i > 0 && (u>>(i-1))&1 == 1 || i < n-1 && (u>>(i+1))&1 == 1) {
				return false
			}
		}
		return true
	}
	var dfs func(int, int) int
	dfs = func(r, s int) int {
		key := r<<n + s
		if _, ok := dp[key]; !ok {
			if !checkRow(r, s) {
				dp[key] = -1
				return -1
			}
			c, p := bits.OnesCount(uint(s)), 0 // å½“å‰è¡Œçš„åº§ä½æ•°
			if r > 0 {
				for i := 0; i < z; i++ { // å°è¯•ä¸Šä¸€è¡Œçš„åº§ä½
					if checkPre(s, i) {
						p = maxVal(p, dfs(r-1, i))
					}
				}
			}
			dp[key] = c + p // è®°å¿†åŒ–
		}
		return dp[key]
	}
	for i := 0; i < z; i++ {
		ms = maxVal(ms, dfs(m-1, i)) // æœ€åä¸€è¡Œ
	}
	return ms
}

//leetcode submit region end(Prohibit modification and deletion)
