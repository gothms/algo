//ç»™ä½ ä¸€ä¸ªæ­£æ•´æ•°æ•°ç»„ arrï¼Œè€ƒè™‘æ‰€æœ‰æ»¡è¶³ä»¥ä¸‹æ¡ä»¶çš„äºŒå‰æ ‘ï¼š
//
//
// æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ 0 ä¸ªæˆ–æ˜¯ 2 ä¸ªå­èŠ‚ç‚¹ã€‚
// æ•°ç»„ arr ä¸­çš„å€¼ä¸æ ‘çš„ä¸­åºéå†ä¸­æ¯ä¸ªå¶èŠ‚ç‚¹çš„å€¼ä¸€ä¸€å¯¹åº”ã€‚
// æ¯ä¸ªéå¶èŠ‚ç‚¹çš„å€¼ç­‰äºå…¶å·¦å­æ ‘å’Œå³å­æ ‘ä¸­å¶èŠ‚ç‚¹çš„æœ€å¤§å€¼çš„ä¹˜ç§¯ã€‚
//
//
// åœ¨æ‰€æœ‰è¿™æ ·çš„äºŒå‰æ ‘ä¸­ï¼Œè¿”å›æ¯ä¸ªéå¶èŠ‚ç‚¹çš„å€¼çš„æœ€å°å¯èƒ½æ€»å’Œã€‚è¿™ä¸ªå’Œçš„å€¼æ˜¯ä¸€ä¸ª 32 ä½æ•´æ•°ã€‚
//
// å¦‚æœä¸€ä¸ªèŠ‚ç‚¹æœ‰ 0 ä¸ªå­èŠ‚ç‚¹ï¼Œé‚£ä¹ˆè¯¥èŠ‚ç‚¹ä¸ºå¶èŠ‚ç‚¹ã€‚
//
//
//
// ç¤ºä¾‹ 1ï¼š
//
//
//è¾“å…¥ï¼šarr = [6,2,4]
//è¾“å‡ºï¼š32
//è§£é‡Šï¼šæœ‰ä¸¤ç§å¯èƒ½çš„æ ‘ï¼Œç¬¬ä¸€ç§çš„éå¶èŠ‚ç‚¹çš„æ€»å’Œä¸º 36 ï¼Œç¬¬äºŒç§éå¶èŠ‚ç‚¹çš„æ€»å’Œä¸º 32 ã€‚
//
//
// ç¤ºä¾‹ 2ï¼š
//
//
//è¾“å…¥ï¼šarr = [4,11]
//è¾“å‡ºï¼š44
//
//
//
//
// æç¤ºï¼š
//
//
// 2 <= arr.length <= 40
// 1 <= arr[i] <= 15
// ç­”æ¡ˆä¿è¯æ˜¯ä¸€ä¸ª 32 ä½å¸¦ç¬¦å·æ•´æ•°ï¼Œå³å°äº 2Â³Â¹ ã€‚
//
//
// Related Topics æ ˆ è´ªå¿ƒ æ•°ç»„ åŠ¨æ€è§„åˆ’ å•è°ƒæ ˆ ğŸ‘ 265 ğŸ‘ 0

package main

import (
	"fmt"
)

func main() {
	arr := []int{6, 2, 4}
	//arr = []int{7, 12, 8, 10, 9, 11}
	arr = []int{15, 13, 5, 3, 15} // 500
	//arr = []int{1, 2, 3, 4, 5}
	values := mctFromLeafValues(arr)
	fmt.Println(values)
}

/*
æ€è·¯ï¼šåŠ¨æ€è§„åˆ’
	1.ç”±é¢˜æ„ï¼š
		1.1.arr[i] éƒ½æ˜¯å¶å­èŠ‚ç‚¹
		1.2.arr[i] è¦æ»¡è¶³ä¸­åºéå†æ’åˆ—ï¼Œåˆ™ä¸èƒ½æ’åº
			åªèƒ½ åŸåœ° åˆ’åˆ†ä¸º å·¦/å³ å­æ ‘
		1.3.len(arr)=nï¼Œåˆ™æœ‰ n-1 ä¸ªä¹˜ç§¯
	2.dp
		2.1.å‡è®¾ arr æ˜¯å‡åºæ’åˆ—ï¼Œarr=[1,2,3,4,5]
			é‚£ä¹ˆæœ€å°ä¹˜ç§¯å’Œä¸ºï¼š1*2 + 2*3 + 3*4 + 4*5
			å¯è§ï¼Œä¸€ä¸ªæ•°æ€»æ˜¯é€‰æ‹© æ¯”è‡ªå·±æ›´å¤§çš„æ•° â€œå½’è¾¹â€
		2.2.å†ä¸¾ä¸ªè¯¦ç»†ä¾‹å­ arr=[7,12,8,10,9,11]ï¼Œç´¢å¼•ä¸º i
			i=0ï¼š0
			i=1ï¼š7*12
			i=2ï¼š7*12 + 12*8
				8 ä¼šé€‰æ‹©æ¯”è‡ªå·±æ›´å¤§çš„ 12 å½’è¾¹ï¼Œä½†æ˜¯ 12 ä¹‹å‰çš„æ•°ï¼Œå…ˆäº 8 å’Œ 12 å½’è¾¹
				ä¸€ä¸ªçˆ¶èŠ‚ç‚¹çš„æ˜¯å¦æ˜¯è¿™æ ·å»ºç«‹çš„ï¼Ÿ8 ä¼šä¸€ç›´å¾€å·¦æ‰¾ï¼š
					å¦‚æœä¸æ¯”è‡ªå·±å¤§ï¼Œåˆ™é€‰æ‹©å’Œè‡ªå·±å½’è¾¹ï¼ˆrightå­æ ‘ï¼‰
					å¦‚æœæ¯”è‡ªå·±å¤§ï¼Œåˆ™åœæ­¢ï¼ˆæ‰¾åˆ°äº†leftå­æ ‘ï¼‰
					æœ€åå’Œè¿™ä¸ªæ¯”è‡ªå·±å¤§çš„æ•°ç›¸ä¹˜ï¼Œå¾—åˆ°ä¸¤è€…çš„çˆ¶èŠ‚ç‚¹
			i=3ï¼š7*12 + 8*10 + 12*10
				10 æ‰¾åˆ° 8ï¼Œæ¯”è‡ªå·±å°ï¼Œå’Œè‡ªå·±å½’è¾¹ï¼š8*10
				10 æ‰¾åˆ° 12ï¼Œæ¯”è‡ªå·±å¤§ï¼Œ10å’Œ12ç›¸ä¹˜ï¼Œå¾—åˆ°äºŒè€…çˆ¶èŠ‚ç‚¹ï¼š12*10
			i=4ï¼š7*12 + 8*10 + 10*12 + 10*9
				9 æ‰¾åˆ° 10ï¼Œæ¯”è‡ªå·±å¤§ï¼Œ9 ç›´æ¥å½’è¾¹äº 10ï¼š10*9
					å¯è§ï¼Œæ­¤æ—¶ç›´æ¥ç”¨ i=3 çš„ æœ€å°ä¹˜ç§¯å’Œ åŠ ä¸Š 10*9 å³å¯
			i=5ï¼šå¯ä»¥è‡ªå·±é€’æ¨ä¸‹
				æ³¨æ„ï¼šä¼šæœ‰ä¸€ä¸ª 11*10ï¼Œå³ æ¯”è‡ªå·±å°çš„æœ€å¤§æ•° * è‡ªå·±ï¼Œæ€è€ƒä¸‹ä¸ºä»€ä¹ˆæœ‰ 11*10
		2.3.ç”±ä¸Šé¢ä¾‹å­å¯çŸ¥ï¼Œæˆ‘ä»¬åªç”¨ä¿ç•™ æ¯”è‡ªå·±ç´¢å¼•å°ä¸”æ¯”è‡ªå·±å€¼å¤§ çš„å…ƒç´ 
			æ¯”å¦‚ i=3 æ—¶ï¼Œarr[2]=8 åœ¨åç»­çš„é€’æ¨ä¸­ï¼Œå·²ç»ä¸éœ€è¦ä¿ç•™ä¸‹æ¥
			é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ª å•è°ƒé€’å‡æ ˆ(stack) æ¥ä¿å­˜ä¹‹å‰çš„å…ƒç´ 
	3.çŠ¶æ€è½¬ç§»æ–¹ç¨‹
		3.1.arr[i] < stack[-1]ï¼š
			dp[i] = dp[i-1] + stack[-1]*arr[i]
		3.2.arr[i] >= stack[-1]ï¼šä»åå¾€å‰éå† stackï¼Œç›´åˆ° stack[j]>arr[i]
			dp[i] = dp[i-1] + stack[j]*arr[i] +
				stack[j-1]*arr[i] - stack[j-1]*stack[j]
			stack=stack[:j]ï¼šå°äºç­‰äº arr[i] çš„æ•°éƒ½ä¸ä¿ç•™
		3.3.è®¡ç®— dp[i] åï¼Œå°† arr[i] è¿½åŠ åˆ° stack å°¾
ä»£ç æ³¨é‡Šï¼š
	1.åˆå§‹åŒ– dp å’Œ stack
	2.dp
		2.1.arr[i] < stack[-1]
		2.2.arr[i] >= stack[-1]
			a)å¯»æ‰¾ stack[j]>arr[i]ï¼Œä¹Ÿå¯ä»¥ äºŒåˆ†æŸ¥æ‰¾
			b)è®¡ç®— dp
			c)æ·˜æ±°ä¸å¤§äº arr[i] çš„å…ƒç´ 
		2.3.è¿½åŠ  arr[i]
*/
//leetcode submit region begin(Prohibit modification and deletion)
func mctFromLeafValues(arr []int) int {
	//dp, stack, n := 0, []int{arr[0]}, len(arr)
	//for i, last := 1, len(stack)-1; i < n; i, last = i+1, len(stack)-1 {
	//	j, v := last, stack[last]
	//	if arr[i] >= stack[j] {
	//		j--
	//		for l := 0; l <= j; {
	//			m := (l + j) >> 1
	//			if stack[m] > arr[i] {
	//				l = m + 1
	//			} else {
	//				j = m - 1
	//			}
	//		}
	//		j++
	//		if j > 0 {
	//			dp += (arr[i] - stack[j]) * stack[j-1]
	//		}
	//		v, stack = stack[j], stack[:j]
	//	}
	//	dp += v * arr[i]
	//	stack = append(stack, arr[i])
	//}
	//return dp

	// dp+å•è°ƒæ ˆ
	//dp, stack, n := arr[0]*arr[1], make([]int, 0), len(arr)
	//if arr[0] >= arr[1] {
	//	stack = append(stack, arr[0])
	//}
	//stack = append(stack, arr[1]) // i ä» 2 å¼€å§‹
	dp, stack, n := 0, []int{arr[0]}, len(arr)                     // 1
	for i, l := 1, len(stack)-1; i < n; i, l = i+1, len(stack)-1 { // 2
		j, v := l, stack[l]
		for j >= 0 && arr[i] >= stack[j] { // 2.2
			j-- // 2.2.a
		}
		if j < l {
			if j++; j > 0 {
				dp += (arr[i] - stack[j]) * stack[j-1] // 2.2.b
			}
			v, stack = stack[j], stack[:j] // 2.2.c
		}
		dp += v * arr[i]              // 2.1 & 2.2.b
		stack = append(stack, arr[i]) // 2.3
	}
	return dp

	// é”™è¯¯ï¼šä¸­åºéå†
	//mct, n := 0, len(arr)
	//sort.Ints(arr)
	//for i := 1; i < n; i++ {
	//	mct += arr[i] * arr[i-1]
	//}
	//return mct
}

//leetcode submit region end(Prohibit modification and deletion)
